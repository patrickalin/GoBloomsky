{{define "header"}}
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<meta name="description" content="Bloomsky client go">
<meta name="author" content="patrickalin@gmail.com">

<title>Bloomsky client Go</title>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="/static/css/bootstrap.min.css" crossorigin="anonymous">
<link rel="stylesheet " href="/static/css/bootstrap-theme.min.css" crossorigin="anonymous">
<link rel="stylesheet " href="/static/css/weather-icons.min.css">
<link rel="stylesheet " href="/static/css/weather-icons-wind.min.css">



<script src="/static/js/jquery-3.2.1.min.js" crossorigin="anonymous "></script>

<!-- Latest compiled and minified JavaScript -->
<script src="/static/js/bootstrap.min.js " crossorigin="anonymous "></script>

<style>
    body {
        padding-top: 50px;
    }
    
    .starter-template {
        padding: 40px 15px;
        text-align: center;
    }
    
    iframe {
        border: none;
    }
</style>








<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js "></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js "></script>
    <![endif]-->


<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script type="text/javascript">
    var humidity
    var arrayTemp = [
        [new Date(1416013200000), 22],
    ]

    window.addEventListener("load", function(evt) {
        var output = document.getElementById("output");
        var ws;
        var print = function(message) {
            var d = document.createElement("div");
            d.innerHTML = message;
            output.appendChild(d);
        };
        socket = new WebSocket("{{.Websockerurl}}");
        //ON OPEN
        socket.onopen = function(evt) {
                // print("OPEN");
                //print(socket.protocol)
                //print(socket.readyState)
                //print(socket.url)
                socket.send("open")
            }
            // ON ERROR
        socket.onerror = function(error) {
            console.error(error);
            print(error);
        };
        socket.onclose = function(evt) {
            print("<b>Connection closed.</b>");
        };
        // ON MESSAGE
        socket.onmessage = function(evt) {
                var currentdate = new Date();
                var datetime = '{{T "Last Sync"}}: ' + currentdate.getDate() + "/" +
                    (currentdate.getMonth() + 1) + "/" +
                    currentdate.getFullYear() + " @ " +
                    currentdate.getHours() + ":" +
                    currentdate.getMinutes() + ":" +
                    currentdate.getSeconds();
                document.getElementById("refreshtime").innerHTML = datetime;

                //To show the data 
                //print("MESSAGE");
                //console.log(evt.data)

                var json = JSON.parse(evt.data);

                humidity = json.Data.Humidity

                drawHumidityPercentage()

                //console.log(json.arrayTemp)

                arrayTemp = [
                    [new Date(1416013200000), 22],
                    [new Date(2014, 10, 15, 0, 30), 23],
                    [new Date(2014, 10, 15, 0, 00), 22],
                    [new Date(2014, 10, 14, 23, 30), 21],
                    [new Date(2014, 10, 14, 23, 00), 22],
                    [new Date(2014, 10, 14, 22, 30), 18],
                ]

                drawTemperature()

            } //end on message

    });


    //CHARTS

    google.charts.load('current', {
        packages: ['corechart', 'line']
    });
    google.charts.setOnLoadCallback(drawTemperature);
    google.charts.setOnLoadCallback(drawHumidityPercentage);


    function drawHumidityPercentage() {

        // Define the chart to be drawn.
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Element');
        data.addColumn('number', 'Percentage');
        data.addRows([
            ['Humidity', humidity],
            ['_', 100 - humidity],
        ]);

        // Instantiate and draw the chart.
        var chartHumidy = new google.visualization.PieChart(document.getElementById('humidityChart'));
        chartHumidy.draw(data, null);
    }

    function drawTemperature() {

        var data = new google.visualization.DataTable();
        data.addColumn('date', 'X');
        data.addColumn('number', 'Temperature');

        data.addRows(arrayTemp);

        var options = {
            hAxis: {
                title: 'Time',
                format: 'H:m',
                minValue: new Date(2014, 10, 14, 21, 30),
                maxValue: new Date(2014, 10, 15, 1, 30),
                gridlines: {
                    count: -1,
                    units: {
                        days: {
                            format: ['MMM dd']
                        },
                        hours: {
                            format: ['HH:mm', 'ha']
                        },
                    }
                },
                minorGridlines: {
                    units: {
                        hours: {
                            format: ['hh:mm:ss a', 'ha']
                        },
                        minutes: {
                            format: ['HH:mm a Z', ':mm']
                        }
                    }
                }
            },
            vAxis: {
                title: 'Temperature',
                format: '#,##Â°C'
            },
            dateFormat: 'MM.dd hh:mm'
        };

        var chartTemp = new google.visualization.LineChart(document.getElementById('temperatureChart'));

        chartTemp.draw(data, options);
    }
</script>

{{ end }}